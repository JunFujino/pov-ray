!==================================================================================================
!
!   ## Global parameters and variables ##
!
!==================================================================================================
module globals
    implicit none
    !----------------------------------------------------------------------------------------------
    !   # Set constant parameter #
    !----------------------------------------------------------------------------------------------
    integer, parameter :: nx = 96                                                   ! Number of grid points
    integer, parameter :: ny = 96                                                   ! Number of grid points
    integer, parameter :: nz = 96                                                   ! Number of grid points
    integer, parameter :: sstep = 1                                                 ! Start step
    integer, parameter :: estep = 20000                                             ! End step
    integer, parameter :: output_step = 5000                                        ! Output frequency
    integer, parameter :: step_start = output_step + sstep - 1
    integer, parameter :: step_end = estep
    integer, parameter :: nstep = estep - sstep + 1
    integer, parameter :: nx_max = nx + 1
    integer, parameter :: ny_max = ny + 1
    integer, parameter :: nz_max = nz + 1
    integer, parameter :: nx_min = -1
    integer, parameter :: ny_min = -1
    integer, parameter :: nz_min = -1
    double precision, parameter :: ds = 1.d0                                        ! Lattice unit
    double precision, parameter :: dds = 1.d0 / ds                                  ! 1/Lattice unit
    double precision, parameter :: dds2 = dds**2.d0                                 ! (1/Lattice unit)**2
    double precision, parameter :: Lx = dble(nx) * ds                               ! [L0]^1
    double precision, parameter :: Ly = dble(ny) * ds                               ! [L0]^1
    double precision, parameter :: Lz = dble(nz) * ds                               ! [L0]^1
    double precision, parameter :: xmin = 0.d0, ymin = 0.d0, zmin = 0.d0
    double precision, parameter :: pi = 4.d0 * atan(1.d0)                           ! pi
    !----------------------------------------------------------------------------------------------
    !   # Set Filename #
    !----------------------------------------------------------------------------------------------
    character(len=120), parameter :: data_scal = "phi"
    character(len=120), parameter :: input_dire_scal = "/data/2019/fujino/lbm/stable_droplet/phi/"
    character(len=120), parameter :: output_dire_cont = "/data/2019/fujino/lbm/stable_droplet/phi/"
    integer, parameter :: file_all = nstep / output_step
    integer, save :: file_num_now
    !----------------------------------------------------------------------------------------------
    !   # Set constant parameter | calculation of phi #
    !----------------------------------------------------------------------------------------------
    double precision, parameter :: phi_min_tmp = 2.638d-1               ![phi0]^1
    double precision, parameter :: phi_max_tmp = 4.031d-1               ![phi0]^1
    double precision, parameter :: v0 = ( phi_max_tmp + phi_min_tmp ) * 0.5d0
    !----------------------------------------------------------------------------------------------
    !   # Global variables #
    !----------------------------------------------------------------------------------------------
    integer, save :: istep, iread                   ! Current time step
    integer :: alpha, beta                          ! Variables for loops
    integer :: i,j,k,l,m,o,m1,m2,o1,o2              ! Variables for loops
    integer :: itr                                  ! Variable for iteration
end module globals
!==================================================================================================
!
!   ## Marching cube ##
!
!==================================================================================================
module marching_cube
    use globals
    implicit none
    integer :: table1(256,15),table2(12,2)
    private
    public mc
    contains
!==================================================================================================
!   ## Main subroutine of marching cube method  ##
!==================================================================================================
    subroutine mc(ifile,ofile,tmp_sum)
        character(*), intent(in) :: ifile,ofile
        integer, intent(out) :: tmp_sum
        double precision, dimension(:,:,:), allocatable :: v_read
        double precision, dimension(:,:,:), allocatable :: v,gx,gy,gz
        double precision, dimension(:), allocatable :: x,y,z
        double precision :: xc(8),yc(8),zc(8),vc(8),gxc(8),gyc(8),gzc(8)
        double precision :: xt,yt,zt,gxt,gyt,gzt
        integer :: ix,iy,iz
        integer :: icube,iside,p1,p2
        integer :: itri
        !-テーブルの設定
        call set_table
        !-データの読込
        allocate(x(0:nx),y(0:ny),z(0:nz),v(0:nx,0:ny,0:nz),v_read(nx_min:nx_max, ny_min:ny_max, nz_min:nz_max))
        open(10,file=ifile,status='old',action='read',form='unformatted')
        read(10) v_read
        v(0:nx,0:ny,0:nz) = v_read(0:nx,0:ny,0:nz)
        close(10)
        deallocate(v_read)
        !-座標の設定
        do iread = 0, nx
            x(iread)= xmin + ds*dble(iread)
        end do
        do iread = 0, ny
            y(iread)= ymin + ds*dble(iread)
        end do
        do iread = 0, nz
            z(iread)= zmin + ds*dble(iread)
        end do
        !-法線ベクトル
        allocate(gx(0:nx,0:ny,0:nz),gy(0:nx,0:ny,0:nz),gz(0:nx,0:ny,0:nz))
        call normal(x,y,z,v,gx,gy,gz)
        open (21,file=ofile,form='unformatted')
        itri=0
        !-主ルーチン
        do ix=0,nx-1
        do iy=0,ny-1
        do iz=0,nz-1
            xc(1)=x(ix+1)
            yc(1)=y(iy)
            zc(1)=z(iz)
            vc(1)=v(ix+1,iy,iz)
            gxc(1)=gx(ix+1,iy,iz)
            gyc(1)=gy(ix+1,iy,iz)
            gzc(1)=gz(ix+1,iy,iz)
        !
            xc(2)=x(ix+1)
            yc(2)=y(iy)
            zc(2)=z(iz+1)
            vc(2)=v(ix+1,iy,iz+1)
            gxc(2)=gx(ix+1,iy,iz+1)
            gyc(2)=gy(ix+1,iy,iz+1)
            gzc(2)=gz(ix+1,iy,iz+1)
        !
            xc(3)=x(ix+1)
            yc(3)=y(iy+1)
            zc(3)=z(iz+1)
            vc(3)=v(ix+1,iy+1,iz+1)
            gxc(3)=gx(ix+1,iy+1,iz+1)
            gyc(3)=gy(ix+1,iy+1,iz+1)
            gzc(3)=gz(ix+1,iy+1,iz+1)
        !
            xc(4)=x(ix+1)
            yc(4)=y(iy+1)
            zc(4)=z(iz)
            vc(4)=v(ix+1,iy+1,iz)
            gxc(4)=gx(ix+1,iy+1,iz)
            gyc(4)=gy(ix+1,iy+1,iz)
            gzc(4)=gz(ix+1,iy+1,iz)
        !
            xc(5)=x(ix)
            yc(5)=y(iy)
            zc(5)=z(iz)
            vc(5)=v(ix,iy,iz)
            gxc(5)=gx(ix,iy,iz)
            gyc(5)=gy(ix,iy,iz)
            gzc(5)=gz(ix,iy,iz)
        !
            xc(6)=x(ix)
            yc(6)=y(iy)
            zc(6)=z(iz+1)
            vc(6)=v(ix,iy,iz+1)
            gxc(6)=gx(ix,iy,iz+1)
            gyc(6)=gy(ix,iy,iz+1)
            gzc(6)=gz(ix,iy,iz+1)
        !
            xc(7)=x(ix)
            yc(7)=y(iy+1)
            zc(7)=z(iz+1)
            vc(7)=v(ix,iy+1,iz+1)
            gxc(7)=gx(ix,iy+1,iz+1)
            gyc(7)=gy(ix,iy+1,iz+1)
            gzc(7)=gz(ix,iy+1,iz+1)
        !
            xc(8)=x(ix)
            yc(8)=y(iy+1)
            zc(8)=z(iz)
            vc(8)=v(ix,iy+1,iz)
            gxc(8)=gx(ix,iy+1,iz)
            gyc(8)=gy(ix,iy+1,iz)
            gzc(8)=gz(ix,iy+1,iz)
        !----立方体の切り方
            icube=1
            do k=1,8
                if(vc(k).lt.v0) icube=icube+2**(k-1)
            end do
        !----三角形を決める
            do k=1,15
                iside=table1(icube,k)
                if(iside.eq.0) exit
                p1=table2(iside,1)
                p2=table2(iside,2)
                call interpolation(xc,yc,zc,vc,p1,p2,xt,yt,zt)
                call interpolation(gxc,gyc,gzc,vc,p1,p2,gxt,gyt,gzt)
                call unit(gxt,gyt,gzt)
                itri=itri+1
                !----------------------------------------------------------------------------------
                !   # Output #
                !----------------------------------------------------------------------------------
                write(21) real(xt, kind=4),real(yt, kind=4),real(zt, kind=4),&
                          real(gxt,kind=4),real(gyt,kind=4),real(gzt,kind=4)
            end do
        end do
        end do
        end do
        tmp_sum = itri
        deallocate(x,y,z,v)
        close (21)
    end subroutine mc
!==================================================================================================
!   ## Interpolation ##
!==================================================================================================
    subroutine interpolation(xc,yc,zc,vc,p1,p2,xt,yt,zt)
        integer, intent(in) :: p1,p2
        double precision, intent(in)  :: xc(8),yc(8),zc(8),vc(8)
        double precision, intent(out) :: xt,yt,zt
        double precision :: c
        c=(v0-vc(p1))/(vc(p2)-vc(p1))
        xt=xc(p1)+c*(xc(p2)-xc(p1))
        yt=yc(p1)+c*(yc(p2)-yc(p1))
        zt=zc(p1)+c*(zc(p2)-zc(p1))
    end subroutine interpolation
!==================================================================================================
!   ## Normal ##
!==================================================================================================
    subroutine normal(x,y,z,v,gx,gy,gz)
        double precision, intent(in) :: x(0:nx)
        double precision, intent(in) :: y(0:ny)
        double precision, intent(in) :: z(0:nz)
        double precision, dimension(0:nx,0:ny,0:nz), intent(in)  :: v
        double precision, dimension(0:nx,0:ny,0:nz), intent(out) :: gx,gy,gz
        double precision :: s1,s2
        integer :: ix,iy,iz
        !-x微分
        ix=0
        do iz=0,nz
        do iy=0,ny
            gx(ix,iy,iz)=(v(ix+1,iy,iz)-v(ix,iy,iz))/(x(ix+1)-x(ix))
        end do
        end do
        do iz=0,nz
        do iy=0,ny
        do ix=1,nx-1
            s2=x(ix+1)-x(ix)
            s1=x(ix)-x(ix-1)
            gx(ix,iy,iz)&
            =((s2**2-s1**2)*v(ix,iy,iz)+(s1**2)*v(ix+1,iy,iz)-(s2**2)*v(ix-1,iy,iz))&
            /((s1*s2)*(s1+s2))
        end do
        end do
        end do
        ix=nx
        do iz=0,nz
        do iy=0,ny
            gx(ix,iy,iz)=(v(ix,iy,iz)-v(ix-1,iy,iz))/(x(ix)-x(ix-1))
        end do
        end do
        !-y微分
        iy=0
        do iz=0,nz
        do ix=0,nx
            gy(ix,iy,iz)=(v(ix,iy+1,iz)-v(ix,iy,iz))/(y(iy+1)-y(iy))
        end do
        end do
        do iz=0,nz
        do iy=1,ny-1
        do ix=0,nx
            s2=y(iy+1)-y(iy)
            s1=y(iy)-y(iy-1)
            gy(ix,iy,iz)&
            =((s2**2-s1**2)*v(ix,iy,iz)+(s1**2)*v(ix,iy+1,iz)-(s2**2)*v(ix,iy-1,iz))&
            /((s1*s2)*(s1+s2))
        end do
        end do
        end do
        iy=ny
        do iz=0,nz
        do ix=0,nx
            gy(ix,iy,iz)=(v(ix,iy,iz)-v(ix,iy-1,iz))/(y(iy)-y(iy-1))
        end do
        end do
        !-z微分
        iz=0
        do iy=0,ny
        do ix=0,nx
            gz(ix,iy,iz)=(v(ix,iy,iz+1)-v(ix,iy,iz))/(z(iz+1)-z(iz))
        end do
        end do
        do iz=1,nz-1
        do iy=0,ny
        do ix=0,nx
            s2=z(iz+1)-z(iz)
            s1=z(iz)-z(iz-1)
            gz(ix,iy,iz)&
            =((s2**2-s1**2)*v(ix,iy,iz)+(s1**2)*v(ix,iy,iz+1)-(s2**2)*v(ix,iy,iz-1))&
            /((s1*s2)*(s1+s2))
        end do
        end do
        end do
        iz=nz
        do iy=0,ny
        do ix=0,nx
            gz(ix,iy,iz)=(v(ix,iy,iz)-v(ix,iy,iz-1))/(z(iz)-z(iz-1))
        end do
        end do
    end subroutine normal
!==================================================================================================
!   ## Make a table ##
!==================================================================================================
    subroutine unit(x,y,z)
        double precision :: x,y,z,c
        c=1.d0/sqrt(x**2+y**2+z**2)
        if (c.ne.0.d0) then
            x=x*c
            y=y*c
            z=z*c
        end if
    end subroutine unit
!==================================================================================================
!   ## Set a table ##
!==================================================================================================
    subroutine set_table
        table1(  1,:)=(/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(  2,:)=(/ 1, 9, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(  3,:)=(/ 1, 2,10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(  4,:)=(/ 2, 9, 4,10, 9, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(  5,:)=(/ 2, 3,11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(  6,:)=(/ 1, 9, 4, 2, 3,11, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(  7,:)=(/10, 3,11, 1, 3,10, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(  8,:)=(/ 3, 9, 4, 3,11, 9,11,10, 9, 0, 0, 0, 0, 0, 0/)
        table1(  9,:)=(/ 4,12, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 10,:)=(/ 1,12, 3, 9,12, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 11,:)=(/ 2,10, 1, 3, 4,12, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 12,:)=(/ 2,12, 3, 2,10,12,10, 9,12, 0, 0, 0, 0, 0, 0/)
        table1( 13,:)=(/ 4,11, 2,12,11, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 14,:)=(/ 1,11, 2, 1, 9,11, 9,12,11, 0, 0, 0, 0, 0, 0/)
        table1( 15,:)=(/ 4,10, 1, 4,12,10,12,11,10, 0, 0, 0, 0, 0, 0/)
        table1( 16,:)=(/10, 9,11,11, 9,12, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 17,:)=(/ 5, 8, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 18,:)=(/ 5, 4, 1, 8, 4, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 19,:)=(/ 1, 2,10, 9, 5, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 20,:)=(/ 5, 2,10, 5, 8, 2, 8, 4, 2, 0, 0, 0, 0, 0, 0/)
        table1( 21,:)=(/ 2, 3,11, 9, 5, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 22,:)=(/ 4, 5, 8, 4, 1, 5, 2, 3,11, 0, 0, 0, 0, 0, 0/)
        table1( 23,:)=(/10, 3,11,10, 1, 3, 9, 5, 8, 0, 0, 0, 0, 0, 0/)
        table1( 24,:)=(/ 3,11,10, 3,10, 8, 3, 8, 4, 8,10, 5, 0, 0, 0/)
        table1( 25,:)=(/ 9, 5, 8, 4,12, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 26,:)=(/12, 5, 8,12, 3, 5, 3, 1, 5, 0, 0, 0, 0, 0, 0/)
        table1( 27,:)=(/10, 1, 2, 9, 5, 8, 3, 4,12, 0, 0, 0, 0, 0, 0/)
        table1( 28,:)=(/ 5, 8,12,10, 5,12,10,12, 3,10, 3, 2, 0, 0, 0/)
        table1( 29,:)=(/ 4,11, 2, 4,12,11, 8, 9, 5, 0, 0, 0, 0, 0, 0/)
        table1( 30,:)=(/ 2,12,11, 2, 5,12, 2, 1, 5, 8,12, 5, 0, 0, 0/)
        table1( 31,:)=(/ 5, 8, 9,10, 1,12,10,12,11,12, 1, 4, 0, 0, 0/)
        table1( 32,:)=(/ 5, 8,12, 5,12,10,10,12,11, 0, 0, 0, 0, 0, 0/)
        table1( 33,:)=(/10, 6, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 34,:)=(/10, 6, 5, 1, 9, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 35,:)=(/ 1, 6, 5, 2, 6, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 36,:)=(/ 9, 6, 5, 9, 4, 6, 4, 2, 6, 0, 0, 0, 0, 0, 0/)
        table1( 37,:)=(/ 2, 3,11,10, 6, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 38,:)=(/ 4, 1, 9, 2, 3,11, 5,10, 6, 0, 0, 0, 0, 0, 0/)
        table1( 39,:)=(/ 6, 3,11, 6, 5, 3, 5, 1, 3, 0, 0, 0, 0, 0, 0/)
        table1( 40,:)=(/ 3,11, 6, 4, 3, 6, 4, 6, 5, 4, 5, 9, 0, 0, 0/)
        table1( 41,:)=(/10, 6, 5, 3, 4,12, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 42,:)=(/ 1,12, 3, 1, 9,12, 5,10, 6, 0, 0, 0, 0, 0, 0/)
        table1( 43,:)=(/ 1, 6, 5, 1, 2, 6, 3, 4,12, 0, 0, 0, 0, 0, 0/)
        table1( 44,:)=(/ 3, 2, 6, 3, 6, 9, 3, 9,12, 5, 9, 6, 0, 0, 0/)
        table1( 45,:)=(/11, 4,12,11, 2, 4,10, 6, 5, 0, 0, 0, 0, 0, 0/)
        table1( 46,:)=(/ 5,10, 6, 1, 9, 2, 9,11, 2, 9,12,11, 0, 0, 0/)
        table1( 47,:)=(/ 6, 5, 1, 6, 1,12, 6,12,11,12, 1, 4, 0, 0, 0/)
        table1( 48,:)=(/ 6, 5, 9, 6, 9,11,11, 9,12, 0, 0, 0, 0, 0, 0/)
        table1( 49,:)=(/10, 8, 9, 6, 8,10, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 50,:)=(/10, 4, 1,10, 6, 4, 6, 8, 4, 0, 0, 0, 0, 0, 0/)
        table1( 51,:)=(/ 1, 8, 9, 1, 2, 8, 2, 6, 8, 0, 0, 0, 0, 0, 0/)
        table1( 52,:)=(/ 2, 6, 4, 4, 6, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 53,:)=(/10, 8, 9,10, 6, 8,11, 2, 3, 0, 0, 0, 0, 0, 0/)
        table1( 54,:)=(/11, 2, 3,10, 6, 1, 6, 4, 1, 6, 8, 4, 0, 0, 0/)
        table1( 55,:)=(/ 9, 1, 3, 9, 3, 6, 9, 6, 8,11, 6, 3, 0, 0, 0/)
        table1( 56,:)=(/ 3,11, 6, 3, 6, 4, 4, 6, 8, 0, 0, 0, 0, 0, 0/)
        table1( 57,:)=(/ 8,10, 6, 8, 9,10, 4,12, 3, 0, 0, 0, 0, 0, 0/)
        table1( 58,:)=(/10, 6, 8,10, 8, 3,10, 3, 1, 3, 8,12, 0, 0, 0/)
        table1( 59,:)=(/ 3, 4,12, 1, 2, 9, 2, 8, 9, 2, 6, 8, 0, 0, 0/)
        table1( 60,:)=(/12, 3, 2,12, 2, 8, 8, 2, 6, 0, 0, 0, 0, 0, 0/)
        table1( 61,:)=(/10, 6, 9, 9, 6, 8,11, 2, 4,11, 4,12, 0, 0, 0/)
        table1( 62,:)=(/ 6, 8, 1, 6, 1,10, 8,12, 1, 2, 1,11,12,11, 1/)
        table1( 63,:)=(/12,11, 1,12, 1, 4,11, 6, 1, 9, 1, 8, 6, 8, 1/)
        table1( 64,:)=(/12,11, 6, 8,12, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 65,:)=(/11, 7, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 66,:)=(/ 1, 9, 4, 6,11, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 67,:)=(/10, 1, 2, 6,11, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 68,:)=(/ 2, 9, 4, 2,10, 9, 6,11, 7, 0, 0, 0, 0, 0, 0/)
        table1( 69,:)=(/ 2, 7, 6, 3, 7, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 70,:)=(/ 2, 7, 6, 2, 3, 7, 4, 1, 9, 0, 0, 0, 0, 0, 0/)
        table1( 71,:)=(/10, 7, 6,10, 1, 7, 1, 3, 7, 0, 0, 0, 0, 0, 0/)
        table1( 72,:)=(/ 6,10, 9, 6, 9, 3, 6, 3, 7, 4, 3, 9, 0, 0, 0/)
        table1( 73,:)=(/ 3, 4,12,11, 7, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 74,:)=(/12, 1, 9,12, 3, 1,11, 7, 6, 0, 0, 0, 0, 0, 0/)
        table1( 75,:)=(/ 1, 2,10, 3, 4,12, 6,11, 7, 0, 0, 0, 0, 0, 0/)
        table1( 76,:)=(/ 6,11, 7, 2,10, 3,10,12, 3,10, 9,12, 0, 0, 0/)
        table1( 77,:)=(/ 7, 4,12, 7, 6, 4, 6, 2, 4, 0, 0, 0, 0, 0, 0/)
        table1( 78,:)=(/ 1, 9,12, 1,12, 6, 1, 6, 2, 6,12, 7, 0, 0, 0/)
        table1( 79,:)=(/ 4,12, 7, 1, 4, 7, 1, 7, 6, 1, 6,10, 0, 0, 0/)
        table1( 80,:)=(/ 7, 6,10, 7,10,12,12,10, 9, 0, 0, 0, 0, 0, 0/)
        table1( 81,:)=(/ 6,11, 7, 5, 8, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 82,:)=(/ 5, 4, 1, 5, 8, 4, 7, 6,11, 0, 0, 0, 0, 0, 0/)
        table1( 83,:)=(/ 2,10, 1, 6,11, 7, 9, 5, 8, 0, 0, 0, 0, 0, 0/)
        table1( 84,:)=(/11, 7, 6, 2,10, 8, 2, 8, 4, 8,10, 5, 0, 0, 0/)
        table1( 85,:)=(/ 7, 2, 3, 7, 6, 2, 5, 8, 9, 0, 0, 0, 0, 0, 0/)
        table1( 86,:)=(/ 2, 3, 6, 6, 3, 7, 4, 1, 5, 4, 5, 8, 0, 0, 0/)
        table1( 87,:)=(/ 9, 5, 8,10, 1, 6, 1, 7, 6, 1, 3, 7, 0, 0, 0/)
        table1( 88,:)=(/ 8, 4,10, 8,10, 5, 4, 3,10, 6,10, 7, 3, 7,10/)
        table1( 89,:)=(/ 4,12, 3, 8, 9, 5,11, 7, 6, 0, 0, 0, 0, 0, 0/)
        table1( 90,:)=(/ 6,11, 7, 5, 8, 3, 5, 3, 1, 3, 8,12, 0, 0, 0/)
        table1( 91,:)=(/ 1, 2,10, 5, 8, 9, 3, 4,12, 6,11, 7, 0, 0, 0/)
        table1( 92,:)=(/10, 3, 2,10,12, 3,10, 5,12, 8,12, 5, 6,11, 7/)
        table1( 93,:)=(/ 9, 5, 8, 4,12, 6, 4, 6, 2, 6,12, 7, 0, 0, 0/)
        table1( 94,:)=(/ 6, 2,12, 6,12, 7, 2, 1,12, 8,12, 5, 1, 5,12/)
        table1( 95,:)=(/ 1, 6,10, 1, 7, 6, 1, 4, 7,12, 7, 4, 9, 5, 8/)
        table1( 96,:)=(/ 7, 6,10, 7,10,12, 5, 8,10, 8,12,10, 0, 0, 0/)
        table1( 97,:)=(/11, 5,10, 7, 5,11, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1( 98,:)=(/ 5,11, 7, 5,10,11, 1, 9, 4, 0, 0, 0, 0, 0, 0/)
        table1( 99,:)=(/11, 1, 2,11, 7, 1, 7, 5, 1, 0, 0, 0, 0, 0, 0/)
        table1(100,:)=(/ 9, 4, 2, 9, 2, 7, 9, 7, 5, 7, 2,11, 0, 0, 0/)
        table1(101,:)=(/ 2, 5,10, 2, 3, 5, 3, 7, 5, 0, 0, 0, 0, 0, 0/)
        table1(102,:)=(/ 4, 1, 9, 2, 3,10, 3, 5,10, 3, 7, 5, 0, 0, 0/)
        table1(103,:)=(/ 1, 3, 5, 5, 3, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(104,:)=(/ 9, 4, 3, 9, 3, 5, 5, 3, 7, 0, 0, 0, 0, 0, 0/)
        table1(105,:)=(/11, 5,10,11, 7, 5,12, 3, 4, 0, 0, 0, 0, 0, 0/)
        table1(106,:)=(/ 1, 9, 3, 3, 9,12, 5,10,11, 5,11, 7, 0, 0, 0/)
        table1(107,:)=(/ 4,12, 3, 1, 2, 7, 1, 7, 5, 7, 2,11, 0, 0, 0/)
        table1(108,:)=(/ 7, 5, 2, 7, 2,11, 5, 9, 2, 3, 2,12, 9,12, 2/)
        table1(109,:)=(/10, 7, 5,10, 4, 7,10, 2, 4,12, 7, 4, 0, 0, 0/)
        table1(110,:)=(/ 9,12, 2, 9, 2, 1,12, 7, 2,10, 2, 5, 7, 5, 2/)
        table1(111,:)=(/ 4,12, 7, 4, 7, 1, 1, 7, 5, 0, 0, 0, 0, 0, 0/)
        table1(112,:)=(/ 7, 5, 9,12, 7, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(113,:)=(/ 8,11, 7, 8, 9,11, 9,10,11, 0, 0, 0, 0, 0, 0/)
        table1(114,:)=(/ 1, 8, 4, 1,11, 8, 1,10,11, 7, 8,11, 0, 0, 0/)
        table1(115,:)=(/11, 7, 8, 2,11, 8, 2, 8, 9, 2, 9, 1, 0, 0, 0/)
        table1(116,:)=(/11, 7, 8,11, 8, 2, 2, 8, 4, 0, 0, 0, 0, 0, 0/)
        table1(117,:)=(/ 2, 3, 7, 2, 7, 9, 2, 9,10, 9, 7, 8, 0, 0, 0/)
        table1(118,:)=(/ 3, 7,10, 3,10, 2, 7, 8,10, 1,10, 4, 8, 4,10/)
        table1(119,:)=(/ 8, 9, 1, 8, 1, 7, 7, 1, 3, 0, 0, 0, 0, 0, 0/)
        table1(120,:)=(/ 8, 4, 3, 7, 8, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(121,:)=(/ 3, 4,12,11, 7, 9,11, 9,10, 9, 7, 8, 0, 0, 0/)
        table1(122,:)=(/ 3, 1, 8, 3, 8,12, 1,10, 8, 7, 8,11,10,11, 8/)
        table1(123,:)=(/ 2, 9, 1, 2, 8, 9, 2,11, 8, 7, 8,11, 3, 4,12/)
        table1(124,:)=(/12, 3, 2,12, 2, 8,11, 7, 2, 7, 8, 2, 0, 0, 0/)
        table1(125,:)=(/ 9,10, 7, 9, 7, 8,10, 2, 7,12, 7, 4, 2, 4, 7/)
        table1(126,:)=(/ 1,10, 2,12, 7, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(127,:)=(/ 8, 9, 1, 8, 1, 7, 4,12, 1,12, 7, 1, 0, 0, 0/)
        table1(128,:)=(/ 8,12, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(129,:)=(/ 8, 7,12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(130,:)=(/ 4, 1, 9,12, 8, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(131,:)=(/ 1, 2,10,12, 8, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(132,:)=(/ 9, 2,10, 9, 4, 2,12, 8, 7, 0, 0, 0, 0, 0, 0/)
        table1(133,:)=(/11, 2, 3, 7,12, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(134,:)=(/ 2, 3,11, 4, 1, 9, 7,12, 8, 0, 0, 0, 0, 0, 0/)
        table1(135,:)=(/ 3,10, 1, 3,11,10, 7,12, 8, 0, 0, 0, 0, 0, 0/)
        table1(136,:)=(/ 7,12, 8, 3,11, 4,11, 9, 4,11,10, 9, 0, 0, 0/)
        table1(137,:)=(/ 8, 3, 4, 7, 3, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(138,:)=(/ 8, 1, 9, 8, 7, 1, 7, 3, 1, 0, 0, 0, 0, 0, 0/)
        table1(139,:)=(/ 3, 8, 7, 3, 4, 8, 1, 2,10, 0, 0, 0, 0, 0, 0/)
        table1(140,:)=(/ 2, 7, 3, 2, 9, 7, 2,10, 9, 9, 8, 7, 0, 0, 0/)
        table1(141,:)=(/11, 8, 7,11, 2, 8, 2, 4, 8, 0, 0, 0, 0, 0, 0/)
        table1(142,:)=(/11, 8, 7, 2, 8,11, 2, 9, 8, 2, 1, 9, 0, 0, 0/)
        table1(143,:)=(/ 1, 4, 8, 1, 8,11, 1,11,10, 7,11, 8, 0, 0, 0/)
        table1(144,:)=(/ 8, 7,11, 8,11, 9, 9,11,10, 0, 0, 0, 0, 0, 0/)
        table1(145,:)=(/ 7, 9, 5,12, 9, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(146,:)=(/ 4, 7,12, 4, 1, 7, 1, 5, 7, 0, 0, 0, 0, 0, 0/)
        table1(147,:)=(/ 9, 7,12, 9, 5, 7,10, 1, 2, 0, 0, 0, 0, 0, 0/)
        table1(148,:)=(/10, 5, 7,10, 7, 4,10, 4, 2,12, 4, 7, 0, 0, 0/)
        table1(149,:)=(/ 7, 9, 5, 7,12, 9, 3,11, 2, 0, 0, 0, 0, 0, 0/)
        table1(150,:)=(/ 2, 3,11, 4, 1,12, 1, 7,12, 1, 5, 7, 0, 0, 0/)
        table1(151,:)=(/ 5,12, 9, 5, 7,12, 1, 3,10, 3,11,10, 0, 0, 0/)
        table1(152,:)=(/11,10, 4,11, 4, 3,10, 5, 4,12, 4, 7, 5, 7, 4/)
        table1(153,:)=(/ 9, 3, 4, 9, 5, 3, 5, 7, 3, 0, 0, 0, 0, 0, 0/)
        table1(154,:)=(/ 1, 5, 3, 5, 7, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(155,:)=(/ 2,10, 1, 3, 4, 5, 3, 5, 7, 5, 4, 9, 0, 0, 0/)
        table1(156,:)=(/ 2,10, 5, 2, 5, 3, 3, 5, 7, 0, 0, 0, 0, 0, 0/)
        table1(157,:)=(/ 9, 2, 4, 9, 7, 2, 9, 5, 7, 7,11, 2, 0, 0, 0/)
        table1(158,:)=(/11, 2, 1,11, 1, 7, 7, 1, 5, 0, 0, 0, 0, 0, 0/)
        table1(159,:)=(/ 5, 7, 4, 5, 4, 9, 7,11, 4, 1, 4,10,11,10, 4/)
        table1(160,:)=(/11,10, 5, 7,11, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(161,:)=(/ 5,10, 6, 8, 7,12, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(162,:)=(/ 1, 9, 4, 5,10, 6,12, 8, 7, 0, 0, 0, 0, 0, 0/)
        table1(163,:)=(/ 6, 1, 2, 6, 5, 1, 8, 7,12, 0, 0, 0, 0, 0, 0/)
        table1(164,:)=(/12, 8, 7, 9, 4, 5, 4, 6, 5, 4, 2, 6, 0, 0, 0/)
        table1(165,:)=(/10, 6, 5,11, 2, 3, 8, 7,12, 0, 0, 0, 0, 0, 0/)
        table1(166,:)=(/ 7,12, 8, 2, 3,11, 1, 9, 4, 5,10, 6, 0, 0, 0/)
        table1(167,:)=(/ 8, 7,12, 6, 5,11, 5, 3,11, 5, 1, 3, 0, 0, 0/)
        table1(168,:)=(/ 4, 5, 9, 4, 6, 5, 4, 3, 6,11, 6, 3,12, 8, 7/)
        table1(169,:)=(/ 8, 3, 4, 8, 7, 3, 6, 5,10, 0, 0, 0, 0, 0, 0/)
        table1(170,:)=(/10, 6, 5, 1, 9, 7, 1, 7, 3, 7, 9, 8, 0, 0, 0/)
        table1(171,:)=(/ 4, 7, 3, 4, 8, 7, 2, 6, 1, 6, 5, 1, 0, 0, 0/)
        table1(172,:)=(/ 7, 3, 9, 7, 9, 8, 3, 2, 9, 5, 9, 6, 2, 6, 9/)
        table1(173,:)=(/10, 6, 5,11, 2, 7, 2, 8, 7, 2, 4, 8, 0, 0, 0/)
        table1(174,:)=(/ 2, 7,11, 2, 8, 7, 2, 1, 8, 9, 8, 1,10, 6, 5/)
        table1(175,:)=(/ 5, 1,11, 5,11, 6, 1, 4,11, 7,11, 8, 4, 8,11/)
        table1(176,:)=(/ 8, 7,11, 8,11, 9, 6, 5,11, 5, 9,11, 0, 0, 0/)
        table1(177,:)=(/ 7,10, 6, 7,12,10,12, 9,10, 0, 0, 0, 0, 0, 0/)
        table1(178,:)=(/ 4, 7,12, 1, 7, 4, 1, 6, 7, 1,10, 6, 0, 0, 0/)
        table1(179,:)=(/ 1,12, 9, 1, 6,12, 1, 2, 6, 6, 7,12, 0, 0, 0/)
        table1(180,:)=(/ 7,12, 4, 7, 4, 6, 6, 4, 2, 0, 0, 0, 0, 0, 0/)
        table1(181,:)=(/ 2, 3,11,10, 6,12,10,12, 9,12, 6, 7, 0, 0, 0/)
        table1(182,:)=(/ 1,12, 4, 1, 7,12, 1,10, 7, 6, 7,10, 2, 3,11/)
        table1(183,:)=(/12, 9, 6,12, 6, 7, 9, 1, 6,11, 6, 3, 1, 3, 6/)
        table1(184,:)=(/ 7,12, 4, 7, 4, 6, 3,11, 4,11, 6, 4, 0, 0, 0/)
        table1(185,:)=(/ 6, 9,10, 6, 3, 9, 6, 7, 3, 4, 9, 3, 0, 0, 0/)
        table1(186,:)=(/10, 6, 7,10, 7, 1, 1, 7, 3, 0, 0, 0, 0, 0, 0/)
        table1(187,:)=(/ 2, 6, 9, 2, 9, 1, 6, 7, 9, 4, 9, 3, 7, 3, 9/)
        table1(188,:)=(/ 2, 6, 7, 3, 2, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(189,:)=(/ 2, 4, 7, 2, 7,11, 4, 9, 7, 6, 7,10, 9,10, 7/)
        table1(190,:)=(/11, 2, 1,11, 1, 7,10, 6, 1, 6, 7, 1, 0, 0, 0/)
        table1(191,:)=(/ 1, 4, 9, 6, 7,11, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(192,:)=(/11, 6, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(193,:)=(/12, 6,11, 8, 6,12, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(194,:)=(/12, 6,11,12, 8, 6, 9, 4, 1, 0, 0, 0, 0, 0, 0/)
        table1(195,:)=(/ 6,12, 8, 6,11,12, 2,10, 1, 0, 0, 0, 0, 0, 0/)
        table1(196,:)=(/11, 8, 6,11,12, 8,10, 9, 2, 9, 4, 2, 0, 0, 0/)
        table1(197,:)=(/12, 2, 3,12, 8, 2, 8, 6, 2, 0, 0, 0, 0, 0, 0/)
        table1(198,:)=(/ 1, 9, 4, 2, 3, 8, 2, 8, 6, 8, 3,12, 0, 0, 0/)
        table1(199,:)=(/10, 8, 6,10, 3, 8,10, 1, 3, 3,12, 8, 0, 0, 0/)
        table1(200,:)=(/ 8, 6, 3, 8, 3,12, 6,10, 3, 4, 3, 9,10, 9, 3/)
        table1(201,:)=(/ 3, 6,11, 3, 4, 6, 4, 8, 6, 0, 0, 0, 0, 0, 0/)
        table1(202,:)=(/ 9, 3, 1, 9, 6, 3, 9, 8, 6,11, 3, 6, 0, 0, 0/)
        table1(203,:)=(/10, 1, 2, 6,11, 4, 6, 4, 8, 4,11, 3, 0, 0, 0/)
        table1(204,:)=(/10, 9, 3,10, 3, 2, 9, 8, 3,11, 3, 6, 8, 6, 3/)
        table1(205,:)=(/ 2, 4, 6, 4, 8, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(206,:)=(/ 1, 9, 8, 1, 8, 2, 2, 8, 6, 0, 0, 0, 0, 0, 0/)
        table1(207,:)=(/10, 1, 4,10, 4, 6, 6, 4, 8, 0, 0, 0, 0, 0, 0/)
        table1(208,:)=(/10, 9, 8, 6,10, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(209,:)=(/ 6, 9, 5, 6,11, 9,11,12, 9, 0, 0, 0, 0, 0, 0/)
        table1(210,:)=(/ 6, 1, 5, 6,12, 1, 6,11,12,12, 4, 1, 0, 0, 0/)
        table1(211,:)=(/ 1, 2,10, 9, 5,11, 9,11,12,11, 5, 6, 0, 0, 0/)
        table1(212,:)=(/11,12, 5,11, 5, 6,12, 4, 5,10, 5, 2, 4, 2, 5/)
        table1(213,:)=(/ 3, 6, 2, 3, 9, 6, 3,12, 9, 5, 6, 9, 0, 0, 0/)
        table1(214,:)=(/ 1, 5,12, 1,12, 4, 5, 6,12, 3,12, 2, 6, 2,12/)
        table1(215,:)=(/ 1, 3, 6, 1, 6,10, 3,12, 6, 5, 6, 9,12, 9, 6/)
        table1(216,:)=(/10, 5, 6, 3,12, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(217,:)=(/ 3, 6,11, 4, 6, 3, 4, 5, 6, 4, 9, 5, 0, 0, 0/)
        table1(218,:)=(/ 6,11, 3, 6, 3, 5, 5, 3, 1, 0, 0, 0, 0, 0, 0/)
        table1(219,:)=(/ 4,11, 3, 4, 6,11, 4, 9, 6, 5, 6, 9, 1, 2,10/)
        table1(220,:)=(/ 6,11, 3, 6, 3, 5, 2,10, 3,10, 5, 3, 0, 0, 0/)
        table1(221,:)=(/ 9, 5, 6, 9, 6, 4, 4, 6, 2, 0, 0, 0, 0, 0, 0/)
        table1(222,:)=(/ 1, 5, 6, 2, 1, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(223,:)=(/ 9, 5, 6, 9, 6, 4,10, 1, 6, 1, 4, 6, 0, 0, 0/)
        table1(224,:)=(/10, 5, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(225,:)=(/ 5,12, 8, 5,10,12,10,11,12, 0, 0, 0, 0, 0, 0/)
        table1(226,:)=(/ 1, 9, 4, 5,10, 8,10,12, 8,10,11,12, 0, 0, 0/)
        table1(227,:)=(/ 2,11,12, 2,12, 5, 2, 5, 1, 8, 5,12, 0, 0, 0/)
        table1(228,:)=(/ 4, 2, 5, 4, 5, 9, 2,11, 5, 8, 5,12,11,12, 5/)
        table1(229,:)=(/ 5,12, 8,10,12, 5,10, 3,12,10, 2, 3, 0, 0, 0/)
        table1(230,:)=(/10, 8, 5,10,12, 8,10, 2,12, 3,12, 2, 1, 9, 4/)
        table1(231,:)=(/12, 8, 5,12, 5, 3, 3, 5, 1, 0, 0, 0, 0, 0, 0/)
        table1(232,:)=(/12, 8, 5,12, 5, 3, 9, 4, 5, 4, 3, 5, 0, 0, 0/)
        table1(233,:)=(/ 3,10,11, 3, 8,10, 3, 4, 8, 8, 5,10, 0, 0, 0/)
        table1(234,:)=(/10,11, 8,10, 8, 5,11, 3, 8, 9, 8, 1, 3, 1, 8/)
        table1(235,:)=(/ 4, 8,11, 4,11, 3, 8, 5,11, 2,11, 1, 5, 1,11/)
        table1(236,:)=(/ 2,11, 3, 9, 8, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(237,:)=(/ 5,10, 2, 5, 2, 8, 8, 2, 4, 0, 0, 0, 0, 0, 0/)
        table1(238,:)=(/ 5,10, 2, 5, 2, 8, 1, 9, 2, 9, 8, 2, 0, 0, 0/)
        table1(239,:)=(/ 5, 1, 4, 8, 5, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(240,:)=(/ 5, 9, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(241,:)=(/10,11, 9,11,12, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(242,:)=(/ 4, 1,10, 4,10,12,12,10,11, 0, 0, 0, 0, 0, 0/)
        table1(243,:)=(/ 1, 2,11, 1,11, 9, 9,11,12, 0, 0, 0, 0, 0, 0/)
        table1(244,:)=(/ 4, 2,11,12, 4,11, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(245,:)=(/ 2, 3,12, 2,12,10,10,12, 9, 0, 0, 0, 0, 0, 0/)
        table1(246,:)=(/ 4, 1,10, 4,10,12, 2, 3,10, 3,12,10, 0, 0, 0/)
        table1(247,:)=(/ 1, 3,12, 9, 1,12, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(248,:)=(/ 4, 3,12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(249,:)=(/ 3, 4, 9, 3, 9,11,11, 9,10, 0, 0, 0, 0, 0, 0/)
        table1(250,:)=(/10,11, 3, 1,10, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(251,:)=(/ 3, 4, 9, 3, 9,11, 1, 2, 9, 2,11, 9, 0, 0, 0/)
        table1(252,:)=(/ 2,11, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(253,:)=(/ 2, 4, 9,10, 2, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(254,:)=(/ 1,10, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(255,:)=(/ 1, 4, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table1(256,:)=(/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/)
        table2=RESHAPE((/1,2,3,1,5,6,7,5,1,2,3,4,2,3,4,4,6,7,8,8,5,6,7,8/),(/12,2/))
    end subroutine set_table
end module marching_cube
!==================================================================================================
!
!   ## Main program ##
!
!==================================================================================================
program main
    use globals
    use marching_cube
    implicit none
    integer :: num_points
    integer, dimension(:), allocatable :: num_points_step_all
    character(len=100) read_dataname
    character(len=100) write_dataname
    character(len=150) write_dataname_points
    !----------------------------------------------------------------------------------------------
    !   # Time development for each procs #
    !----------------------------------------------------------------------------------------------
    file_num_now = 0
    allocate(num_points_step_all(1:file_all))
    do istep = step_start, step_end, output_step
        !------------------------------------------------------------------------------------------
        !   # Marching cube #
        !------------------------------------------------------------------------------------------
        write(read_dataname,"(a,i7.7,a,a,a)") trim(input_dire_scal),istep,"_",trim(data_scal),".d"
        write(write_dataname,"(a,i7.7,a,a,a)") trim(output_dire_cont),istep,"_isosurface_",trim(data_scal),".d"
        call mc(read_dataname,write_dataname,num_points)
        !------------------------------------------------------------------------------------------
        !   # Stock the number of points #
        !------------------------------------------------------------------------------------------
        file_num_now = file_num_now + 1
        num_points_step_all(file_num_now) = num_points
    enddo
    !----------------------------------------------------------------------------------------------
    !   # Output the number of coordinates of points for polygons #
    !----------------------------------------------------------------------------------------------
    write(write_dataname_points,"(a,i7.7,a,i7.7,a,a)") trim(output_dire_cont),sstep,"to",estep,&
                                                       trim(data_scal),"_isosurface_num_points.d"
    open(22,file=write_dataname_points,status="replace", form="unformatted", action="write", & 
            access="direct", recl = 4*file_all)
    write(22,rec=1) num_points_step_all
    close(22)
    !----------------------------------------------------------------------------------------------
    !   # End program #
    !----------------------------------------------------------------------------------------------
    deallocate(num_points_step_all)
end program main